name: Remote Tunnel Access

on: [workflow_dispatch] # Only run manually

jobs:
  dev_tunnel:
    runs-on: windows-latest
    # Set a reasonable timeout for your debugging/development session (e.g., 6 hours)
    timeout-minutes: 360

    steps:
      # 1. Download and Extract the VS Code CLI
      - name: Download VS Code CLI
        run: |
          Invoke-WebRequest https://code.visualstudio.com/sha/download?build=stable&platform=cli -OutFile vscode-cli.zip
          Expand-Archive vscode-cli.zip -DestinationPath vscli
        shell: pwsh

      # 2. Add CLI to PATH for easier use
      - name: Add VS Code CLI to PATH
        run: $env:PATH = "$env:GITHUB_WORKSPACE\vscli;$env:PATH"
        shell: pwsh

      # 3. Start the VS Code Remote Tunnel
      - name: Start VS Code Tunnel
        # The '&' runs the tunnel process in the background, allowing the subsequent step to run.
        # This is CRITICAL for the keep-alive action to work.
        run: ./vscli/code.exe tunnel &
        shell: pwsh
        env:
          # Your GitHub token is needed to authenticate the VS Code Tunnel.
          # You MUST use a Personal Access Token (PAT) with 'workflow' scope and store it as a secret (e.g., VSCODE_PAT).
          GITHUB_TOKEN: ${{ secrets.VSCODE_PAT }}

      # 4. Keep the job alive while the tunnel runs
      # This action simply loops and prevents the job from completing,
      # allowing the background tunnel process to remain active until timeout-minutes is reached.
      - name: Keep Job Alive
        steps:
          - uses: actions/checkout@v4
          - uses: gautamkrishnar/keepalive-workflow@v2
